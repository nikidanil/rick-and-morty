import { Component, type ErrorInfo, type ReactNode } from 'react';
import style from './ErrorBoundary.module.css';

/**
 * –¢–∏–ø —Å–≤–æ–π—Å—Ç–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ErrorBoundary.
 *
 * @property {ReactNode} children - –î–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è, –µ—Å–ª–∏ –æ—à–∏–±–æ–∫ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ.
 * @property {ReactNode} [fallback] - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–π –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
 */
type Props = {
	children: ReactNode;
	fallback?: ReactNode;
};

/**
 * –¢–∏–ø —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ErrorBoundary.
 *
 * @property {boolean} hasError - –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–∫–∏ –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö.
 * @property {string} [errorMessage] - –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ, –≤–æ–∑–Ω–∏–∫—à–µ–π –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö.
 */
type State = {
	hasError: boolean;
	errorMessage?: string;
};

/**
 * –ö–æ–º–ø–æ–Ω–µ–Ω—Ç ErrorBoundary ‚Äî –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ JavaScript-–æ—à–∏–±–æ–∫ –≤ –¥–µ—Ä–µ–≤–µ React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.
 *
 * –≠—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ª–æ–≤–∞ –æ—à–∏–±–æ–∫, –≤–æ–∑–Ω–∏–∫–∞—é—â–∏—Ö –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤,
 * –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
 *
 * –û—à–∏–±–∫–∏, –≤–æ–∑–Ω–∏–∫–∞—é—â–∏–µ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö —Å–æ–±—ã—Ç–∏–π, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö –∏–ª–∏ –≤ —Å–∞–º–æ–º ErrorBoundary,
 * –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è.
 *
 * @example
 * <ErrorBoundary fallback={<p>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞</p>}>
 *   <MyComponent />
 * </ErrorBoundary>
 */
export class ErrorBoundary extends Component<Props, State> {
	/**
	 * –°–æ–∑–¥–∞—ë—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä ErrorBoundary.
	 *
	 * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ–∑ –æ—à–∏–±–æ–∫.
	 *
	 * @param {Props} props - –°–≤–æ–π—Å—Ç–≤–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.
	 */
	constructor(props: Props) {
		super(props);

		this.state = {
			hasError: false,
		};
	}

	/**
	 * –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥, –≤—ã–∑—ã–≤–∞–µ–º—ã–π –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö.
	 *
	 * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è —Ñ–ª–∞–≥ –æ—à–∏–±–∫–∏ –∏ –µ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ.
	 *
	 * @param {Error} error - –û–±—ä–µ–∫—Ç –æ—à–∏–±–∫–∏, –≤—ã–±—Ä–æ—à–µ–Ω–Ω—ã–π –≤ –¥–æ—á–µ—Ä–Ω–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ.
	 * @returns {State} –ù–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Ñ–ª–∞–≥–æ–º –æ—à–∏–±–∫–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ–º.
	 */
	static getDerivedStateFromError(error: Error): State {
		return {
			hasError: true,
			errorMessage: error.message.toString(),
		};
	}

	/**
	 * –ú–µ—Ç–æ–¥ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞, –≤—ã–∑—ã–≤–∞–µ–º—ã–π —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –æ—à–∏–±–∫–∞ –±—ã–ª–∞ –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–∞.
	 *
	 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π, —Ç–∞–∫–∏—Ö –∫–∞–∫ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤ –≤–Ω–µ—à–Ω—é—é —Å–∏—Å—Ç–µ–º—É.
	 *
	 * @param {Error} error - –û–±—ä–µ–∫—Ç –æ—à–∏–±–∫–∏, –≤—ã–±—Ä–æ—à–µ–Ω–Ω—ã–π –≤ –¥–æ—á–µ—Ä–Ω–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ.
	 * @param {ErrorInfo} errorInfo - –û–±—ä–µ–∫—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.
	 */
	componentDidCatch(error: Error, errorInfo: ErrorInfo) {
		console.error('Error caught by ErrorBoundary:', error, errorInfo);
	}

	/**
	 * –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.
	 *
	 * –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
	 * –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã.
	 *
	 * @returns {ReactNode} –û—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.
	 */
	render() {
		if (this.state.hasError) {
			return (
				<div className={style.errorBoundary}>
					<h2>–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ üòï</h2>
					<p>{this.state.errorMessage}</p>
					{this.props.fallback}
				</div>
			);
		}

		return this.props.children;
	}
}
